<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Paris piéton</title>
    <link rel="stylesheet" href="style.css" />
 <script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />
    <link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css">
    <script src="display-map.js"></script>
  </head>
  <body>
    <div id="chooser">
      <ul id="choices">
        <li class="active" data-mapId="trottoirs.9a57f77c">Taille des trottoirs</li>
        <li data-mapId="laem.ca825d58">Paris piéton</li>
      </ul>
      <div id="explanation-text" class="explanations">
        <div data-mapId="trottoirs.9a57f77c">
          <p>
            Visualiser les trottoirs de Paris <br/>
            colorés en fonction de leur largeur
          </p>
        </div>
        <div data-mapId="mapbox://styles/kont/cklqxm3vz032x17nwtb12vkq2">
          <p>
            Visualiser les trottoirs, les zones <br/>
            piétonnes et les espaces verts
          </p>
        </div>
      </div>
    </div>
    <div id="legend" data-mapId="mapbox://styles/kont/cklqxm3vz032x17nwtb12vkq2">
      <p>
        Largeur des trottoirs :
      </p>
      <ul >
        <li><span class="legend-color" style="background: #8cd4bb"></span> plus de 5m</li>
        <li><span class="legend-color" style="background: #b1b0e6"></span> moins de 5m</li>
        <li><span class="legend-color" style="background: #ff9800"></span> moins de 2m</li>
        <li><span class="legend-color" style="background: #f44336"></span> moins de 1.5m</li>
      </ul>
    </div>
    <div id="what">
      <a href="https://github.com/laem/trottoirs-de-paris" target="_blank">?</a>
    </div>
    <div id="map"></div>

  <script type="text/javascript">
    (function() {
      L.mapbox.accessToken = 'pk.eyJ1IjoibGFlbSIsImEiOiJ1Qjh4a1JNIn0.BGQeLm-XAzTgLF9t25VSKw';
      var map;
      function displayMap(id){
        if (map != null) map.remove()
        id = id || 'mapbox://styles/kont/cklqxm3vz032x17nwtb12vkq2'
        map = L.mapbox.map('map')
            .setView([48.85546, 2.34989], 15)
            .addLayer(L.mapbox.styleLayer(id));
      }

      displayMap()

      var choices = document.querySelectorAll('#choices li');

      [].forEach.call(choices, function(el){
        el.onclick = function(){
          [].forEach.call(choices, function(eel){
            eel.className = eel === el ? 'active' : ''
          })
          var legend = document.querySelector('#legend')
          if (el.dataset.mapid === legend.dataset.mapid ) {
            legend.style.display = 'block'
          } else {
            legend.style.display = 'none'
          }
          var id = el.dataset.mapid
          displayMap(id)
        }
        el.addEventListener('mouseover', function(){
          [].forEach.call(document.querySelectorAll('.explanations div'), function(eel){
            //debugger;
            if (eel.dataset.mapid  === el.dataset.mapid){
              eel.style.display = 'inline'
            }
          })
        })
        el.addEventListener('mouseout', function(){
          [].forEach.call(document.querySelectorAll('.explanations div'), function(eel){
            eel.style.display = 'none'
          })
        })
      })

    })()

  </script>
  </body>
</html>
